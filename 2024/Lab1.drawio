<mxfile host="app.diagrams.net" modified="2024-05-05T10:41:28.185Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0" etag="yhQu9iDAN82q3XsPXHxu" version="24.3.1" type="github">
  <diagram name="第 1 页" id="L96vX1XhK6QXdYlFLpfw">
    <mxGraphModel dx="1420" dy="393" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Ul97I4Ve1XMXk0d_GilV-1" target="Ul97I4Ve1XMXk0d_GilV-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-10" value="核心:progress = try_to_free_pages(ac-&amp;gt;zonelist, order, gfp_mask,&lt;div&gt;&lt;span style=&quot;white-space-collapse: collapse;&quot;&gt;&lt;span style=&quot;white-space-collapse: preserve;&quot;&gt;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;ac-&amp;gt;nodemask);&lt;/span&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Ul97I4Ve1XMXk0d_GilV-3">
          <mxGeometry x="0.3396" relative="1" as="geometry">
            <mxPoint y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-1" value="&lt;div&gt;__perform_reclaim()&lt;br&gt;&lt;/div&gt;定义在mm/page_alloc.c中&lt;div&gt;//直接同步页面回收&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-57.5" y="220" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Ul97I4Ve1XMXk0d_GilV-2" target="Ul97I4Ve1XMXk0d_GilV-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-17" value="核心：nr_reclaimed = do_try_to_free_pages(zonelist, &amp;amp;sc);" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Ul97I4Ve1XMXk0d_GilV-16">
          <mxGeometry x="0.0519" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-2" value="&lt;div&gt;try_to_free_pages(&lt;span style=&quot;background-color: initial;&quot;&gt;struct zonelist *zonelist, int order,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gfp_t gfp_mask, nodemask_t *nodemask&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;声明在swap.h中&lt;/div&gt;&lt;div&gt;定义在mm/vmscan.c中&lt;/div&gt;&lt;div style=&quot;text-align: justify;&quot;&gt;//&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;white-space-collapse: preserve; color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;尝试从指定的内存区域（zonelist）中回收足够的连续页面来满足请求。它根据&lt;/span&gt;&lt;code style=&quot;white-space-collapse: break-spaces; box-sizing: border-box; --un-rotate: 0; --un-rotate-x: 0; --un-rotate-y: 0; --un-rotate-z: 0; --un-scale-x: 1; --un-scale-y: 1; --un-scale-z: 1; --un-skew-x: 0; --un-skew-y: 0; --un-translate-x: 0; --un-translate-y: 0; --un-translate-z: 0; --un-pan-x: ; --un-pan-y: ; --un-pinch-zoom: ; --un-scroll-snap-strictness: proximity; --un-ordinal: ; --un-slashed-zero: ; --un-numeric-figure: ; --un-numeric-spacing: ; --un-numeric-fraction: ; --un-border-spacing-x: 0; --un-border-spacing-y: 0; --un-ring-offset-shadow: 0 0 transparent; --un-ring-shadow: 0 0 transparent; --un-shadow-inset: ; --un-shadow: 0 0 transparent; --un-ring-inset: ; --un-ring-offset-width: 0px; --un-ring-offset-color: #fff; --un-ring-width: 0px; --un-ring-color: rgba(147,197,253,.5); --un-blur: ; --un-brightness: ; --un-contrast: ; --un-drop-shadow: ; --un-grayscale: ; --un-hue-rotate: ; --un-invert: ; --un-saturate: ; --un-sepia: ; --un-backdrop-blur: ; --un-backdrop-brightness: ; --un-backdrop-contrast: ; --un-backdrop-grayscale: ; --un-backdrop-hue-rotate: ; --un-backdrop-invert: ; --un-backdrop-opacity: ; --un-backdrop-saturate: ; --un-backdrop-sepia: ; font-family: ui-monospace, SFMono-Regular, &amp;quot;SF Mono&amp;quot;, Menlo, Consolas, &amp;quot;Liberation Mono&amp;quot;, monospace; background-color: rgba(175, 184, 193, 0.2); border-radius: 6px; margin: 0px; padding: 0.2em 0.4em; color: rgb(44, 44, 54); text-align: left;&quot;&gt;gfp_mask&lt;/code&gt;&lt;span style=&quot;white-space-collapse: preserve; color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;和&lt;/span&gt;&lt;code style=&quot;white-space-collapse: break-spaces; box-sizing: border-box; --un-rotate: 0; --un-rotate-x: 0; --un-rotate-y: 0; --un-rotate-z: 0; --un-scale-x: 1; --un-scale-y: 1; --un-scale-z: 1; --un-skew-x: 0; --un-skew-y: 0; --un-translate-x: 0; --un-translate-y: 0; --un-translate-z: 0; --un-pan-x: ; --un-pan-y: ; --un-pinch-zoom: ; --un-scroll-snap-strictness: proximity; --un-ordinal: ; --un-slashed-zero: ; --un-numeric-figure: ; --un-numeric-spacing: ; --un-numeric-fraction: ; --un-border-spacing-x: 0; --un-border-spacing-y: 0; --un-ring-offset-shadow: 0 0 transparent; --un-ring-shadow: 0 0 transparent; --un-shadow-inset: ; --un-shadow: 0 0 transparent; --un-ring-inset: ; --un-ring-offset-width: 0px; --un-ring-offset-color: #fff; --un-ring-width: 0px; --un-ring-color: rgba(147,197,253,.5); --un-blur: ; --un-brightness: ; --un-contrast: ; --un-drop-shadow: ; --un-grayscale: ; --un-hue-rotate: ; --un-invert: ; --un-saturate: ; --un-sepia: ; --un-backdrop-blur: ; --un-backdrop-brightness: ; --un-backdrop-contrast: ; --un-backdrop-grayscale: ; --un-backdrop-hue-rotate: ; --un-backdrop-invert: ; --un-backdrop-opacity: ; --un-backdrop-saturate: ; --un-backdrop-sepia: ; font-family: ui-monospace, SFMono-Regular, &amp;quot;SF Mono&amp;quot;, Menlo, Consolas, &amp;quot;Liberation Mono&amp;quot;, monospace; background-color: rgba(175, 184, 193, 0.2); border-radius: 6px; margin: 0px; padding: 0.2em 0.4em; color: rgb(44, 44, 54); text-align: left;&quot;&gt;order&lt;/code&gt;&lt;span style=&quot;white-space-collapse: preserve; color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;参数，采用不同的策略（如LRU页面淘汰、交换等）来释放内存。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-107.5" y="370" width="260" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Ul97I4Ve1XMXk0d_GilV-15" target="Ul97I4Ve1XMXk0d_GilV-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-20" value="核心：shrink_zones(zonelist, sc);" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Ul97I4Ve1XMXk0d_GilV-19">
          <mxGeometry x="-0.0068" y="3" relative="1" as="geometry">
            <mxPoint x="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-15" value="&lt;div&gt;&lt;div&gt;do_try_to_free_pages(struct zonelist *zonelist,&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;struct scan_control *sc)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;定义在mm/vmscan.c中&lt;/div&gt;&lt;div&gt;//循环调整sc的优先级，每次都&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left;&quot;&gt;调用&lt;/span&gt;&lt;code style=&quot;color: rgb(44, 44, 54); text-align: left; white-space-collapse: break-spaces; box-sizing: border-box; --un-rotate: 0; --un-rotate-x: 0; --un-rotate-y: 0; --un-rotate-z: 0; --un-scale-x: 1; --un-scale-y: 1; --un-scale-z: 1; --un-skew-x: 0; --un-skew-y: 0; --un-translate-x: 0; --un-translate-y: 0; --un-translate-z: 0; --un-pan-x: ; --un-pan-y: ; --un-pinch-zoom: ; --un-scroll-snap-strictness: proximity; --un-ordinal: ; --un-slashed-zero: ; --un-numeric-figure: ; --un-numeric-spacing: ; --un-numeric-fraction: ; --un-border-spacing-x: 0; --un-border-spacing-y: 0; --un-ring-offset-shadow: 0 0 transparent; --un-ring-shadow: 0 0 transparent; --un-shadow-inset: ; --un-shadow: 0 0 transparent; --un-ring-inset: ; --un-ring-offset-width: 0px; --un-ring-offset-color: #fff; --un-ring-width: 0px; --un-ring-color: rgba(147,197,253,.5); --un-blur: ; --un-brightness: ; --un-contrast: ; --un-drop-shadow: ; --un-grayscale: ; --un-hue-rotate: ; --un-invert: ; --un-saturate: ; --un-sepia: ; --un-backdrop-blur: ; --un-backdrop-brightness: ; --un-backdrop-contrast: ; --un-backdrop-grayscale: ; --un-backdrop-hue-rotate: ; --un-backdrop-invert: ; --un-backdrop-opacity: ; --un-backdrop-saturate: ; --un-backdrop-sepia: ; font-family: ui-monospace, SFMono-Regular, &amp;quot;SF Mono&amp;quot;, Menlo, Consolas, &amp;quot;Liberation Mono&amp;quot;, monospace; background-color: rgba(175, 184, 193, 0.2); border-radius: 6px; margin: 0px; padding: 0.2em 0.4em;&quot;&gt;shrink_zones&lt;/code&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left;&quot;&gt;遍历内存区域列表，尝试回收页面。&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-120" y="580" width="285" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="Ul97I4Ve1XMXk0d_GilV-18" target="Ul97I4Ve1XMXk0d_GilV-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-35" value="核心：shrink_node(zone-&amp;gt;zone_pgdat, sc);" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Ul97I4Ve1XMXk0d_GilV-34">
          <mxGeometry x="0.0214" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-18" value="shrink_zones(struct zonelist *zonelist, struct scan_control *sc)&lt;div&gt;定义在mm/vmscan.c中&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-72.5" y="730" width="190" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-21" value="直接页面回收" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-27.5" y="168" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-22" value="页交换守护进程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="358.75" y="179" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Ul97I4Ve1XMXk0d_GilV-23" target="Ul97I4Ve1XMXk0d_GilV-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-31" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;核心：reclaim_order = balance_pgdat(pgdat, alloc_order, classzone_idx);&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Ul97I4Ve1XMXk0d_GilV-29">
          <mxGeometry x="-0.079" y="5" relative="1" as="geometry">
            <mxPoint y="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-23" value="static int kswapd(void *p)&lt;div&gt;定义在vmscan.c中&lt;/div&gt;&lt;div&gt;/&lt;font style=&quot;font-size: 12px;&quot;&gt;/&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: start; white-space-collapse: preserve;&quot;&gt;Linux内核中负责页面交换守护进程（kswapd）的核心实现，它是内存管理系统中的关键后台线程，主要任务是监控内存使用情况并在内存紧张时自动释放页面到交换空间，以保证系统有充足的可用内存。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="275" y="231" width="277.5" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-26" value="balance_pgdat(pg_data_t *pgdat, int order, int classzone_idx)&lt;div&gt;定义在mm/vmscan.c中&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(44, 44, 54); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left;&quot;&gt;，根据给定的订单和区域索引，执行内存回收操作。它尝试从内存中移除页面，必要时通过交换机制释放物理内存。&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="273" y="410" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ul97I4Ve1XMXk0d_GilV-33" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-37.5" y="880" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
